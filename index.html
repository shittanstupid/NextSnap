<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>NextSnap ‚Äì Live NFL Play Predictor</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }
    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI",
        sans-serif;
      background: radial-gradient(circle at top, #1c2333 0, #050812 55%, #020308 100%);
      color: #f5f7ff;
      min-height: 100vh;
    }
    a {
      color: #56c3ff;
      text-decoration: none;
    }
    #app {
      max-width: 1100px;
      margin: 0 auto;
      padding: 16px 12px 40px;
    }
    header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 12px;
      gap: 8px;
    }
    header h1 {
      font-size: 26px;
      letter-spacing: 0.04em;
      display: flex;
      align-items: center;
      gap: 8px;
    }
    .pill {
      display: inline-flex;
      align-items: center;
      padding: 3px 10px;
      border-radius: 999px;
      font-size: 11px;
      border: 1px solid rgba(255, 255, 255, 0.12);
      background: linear-gradient(135deg, rgba(85, 202, 255, 0.18), transparent);
      color: #d0eaff;
    }
    .logo-ball {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      width: 20px;
      height: 20px;
      border-radius: 50%;
      background: radial-gradient(circle at 30% 30%, #ffcc88, #ff5c3b);
      box-shadow: 0 0 8px rgba(255, 132, 80, 0.6);
      font-size: 11px;
    }

    /* Buttons & inputs */
    .btn {
      border: none;
      border-radius: 999px;
      padding: 8px 16px;
      background: linear-gradient(135deg, #0f9ad8, #27c2ff);
      color: #041019;
      font-weight: 600;
      font-size: 14px;
      cursor: pointer;
      box-shadow: 0 0 12px rgba(60, 199, 255, 0.35);
      transition: transform 0.08s ease, box-shadow 0.08s ease, filter 0.08s ease;
      white-space: nowrap;
    }
    .btn:hover {
      transform: translateY(-1px);
      filter: brightness(1.07);
      box-shadow: 0 0 18px rgba(60, 199, 255, 0.5);
    }
    .btn:active {
      transform: translateY(0);
      box-shadow: 0 0 10px rgba(60, 199, 255, 0.35);
    }
    .btn-secondary {
      background: transparent;
      border: 1px solid rgba(255, 255, 255, 0.25);
      color: #e7f1ff;
      box-shadow: none;
    }
    .btn-secondary:hover {
      background: rgba(255, 255, 255, 0.06);
      box-shadow: 0 0 8px rgba(255, 255, 255, 0.16);
    }
    .btn-danger {
      background: linear-gradient(135deg, #ff4b5a, #dd2240);
      color: #fff7f7;
      box-shadow: 0 0 12px rgba(255, 87, 115, 0.45);
    }

    input[type="text"] {
      width: 100%;
      border-radius: 999px;
      border: 1px solid rgba(255, 255, 255, 0.18);
      padding: 8px 14px;
      background: rgba(4, 10, 22, 0.9);
      color: #f5f7ff;
      font-size: 14px;
      outline: none;
    }
    input[type="text"]::placeholder {
      color: rgba(196, 209, 233, 0.7);
    }
    input[type="text"]:focus {
      border-color: #44c1ff;
      box-shadow: 0 0 0 1px rgba(73, 195, 255, 0.5);
    }

    .hidden {
      display: none !important;
    }

    /* Lobby */
    #lobbyView {
      margin-top: 10px;
      padding: 18px;
      border-radius: 18px;
      background: radial-gradient(circle at top, rgba(58, 95, 180, 0.45), rgba(5, 10, 25, 0.95));
      box-shadow: 0 22px 40px rgba(0, 0, 0, 0.45);
      border: 1px solid rgba(134, 177, 255, 0.3);
    }
    #lobbyView h2 {
      font-size: 20px;
      margin-bottom: 10px;
    }
    .lobby-row {
      display: flex;
      gap: 10px;
      align-items: center;
      margin-bottom: 6px;
      flex-wrap: wrap;
    }
    .lobby-caption {
      font-size: 13px;
      color: rgba(219, 229, 255, 0.8);
    }

    /* Game layout */
    #gameView {
      margin-top: 10px;
      padding: 18px;
      border-radius: 18px;
      background: radial-gradient(circle at top, rgba(42, 70, 135, 0.6), rgba(4, 7, 20, 0.98));
      box-shadow: 0 22px 40px rgba(0, 0, 0, 0.55);
      border: 1px solid rgba(126, 169, 252, 0.32);
    }
    .game-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      flex-wrap: wrap;
      gap: 8px;
      margin-bottom: 14px;
    }
    .game-title {
      font-size: 17px;
      font-weight: 600;
    }
    .game-meta {
      font-size: 12px;
      color: rgba(211, 223, 255, 0.78);
    }
    .active-player-summary {
      font-size: 12px;
      color: rgba(211, 223, 255, 0.78);
      text-align: right;
    }

    .game-grid {
      display: grid;
      grid-template-columns: minmax(0, 1.2fr) minmax(0, 1.4fr);
      gap: 14px;
      margin-top: 10px;
    }
    .panel {
      background: radial-gradient(circle at top left, rgba(86, 138, 255, 0.24), rgba(5, 10, 25, 0.97));
      border-radius: 18px;
      padding: 14px 14px 16px;
      position: relative;
      border: 1px solid rgba(133, 175, 255, 0.42);
      box-shadow: 0 16px 30px rgba(0, 0, 0, 0.5);
      overflow: hidden;
    }
    .panel::before {
      content: "";
      position: absolute;
      inset: 0;
      background: radial-gradient(circle at top left, rgba(120, 188, 255, 0.16), transparent 60%);
      opacity: 0.9;
      pointer-events: none;
    }
    .panel h3 {
      position: relative;
      font-size: 16px;
      margin-bottom: 8px;
    }
    .panel-sub {
      position: relative;
      font-size: 11px;
      color: rgba(210, 225, 255, 0.78);
      margin-bottom: 10px;
    }

    .section-label {
      position: relative;
      font-size: 11px;
      font-weight: 600;
      margin-top: 6px;
      margin-bottom: 4px;
      text-transform: uppercase;
      letter-spacing: 0.09em;
      color: rgba(203, 219, 255, 0.9);
    }

    .btn-row {
      position: relative;
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
      margin-bottom: 4px;
    }
    .choice-btn {
      border-radius: 999px;
      padding: 7px 14px;
      border: 1px solid rgba(120, 191, 255, 0.4);
      background: radial-gradient(circle at top, rgba(22, 166, 253, 0.9), rgba(11, 95, 200, 0.9));
      color: #03121f;
      font-size: 13px;
      font-weight: 600;
      cursor: pointer;
      box-shadow: 0 0 14px rgba(64, 188, 255, 0.4);
      transition: transform 0.07s ease, box-shadow 0.07s ease, filter 0.07s ease;
      white-space: nowrap;
    }
    .choice-btn:hover {
      transform: translateY(-1px);
      filter: brightness(1.07);
    }
    .choice-btn:active {
      transform: translateY(0);
      box-shadow: 0 0 10px rgba(64, 188, 255, 0.3);
    }
    .choice-btn.inactive {
      background: rgba(10, 22, 45, 0.96);
      color: #cdd9ff;
      border-color: rgba(133, 173, 255, 0.5);
      box-shadow: none;
    }
    .choice-btn.inactive:hover {
      background: rgba(23, 42, 78, 0.96);
      box-shadow: 0 0 8px rgba(89, 169, 255, 0.35);
    }
    .choice-btn.disabled {
      opacity: 0.35;
      cursor: default;
      box-shadow: none;
      border-style: dashed;
    }

    .controls-row {
      position: relative;
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      margin-top: 8px;
      margin-bottom: 10px;
    }

    .summary-text {
      position: relative;
      font-size: 12px;
      margin-top: 4px;
      color: #dee9ff;
    }

    .last-snaps-box {
      position: relative;
      margin-top: 10px;
      padding: 8px 9px;
      border-radius: 10px;
      background: rgba(8, 18, 40, 0.96);
      border: 1px solid rgba(156, 188, 255, 0.4);
      max-height: 140px;
      overflow-y: auto;
      font-size: 11px;
    }
    .last-snaps-title {
      font-weight: 600;
      margin-bottom: 4px;
      color: rgba(215, 228, 255, 0.95);
    }
    .last-snap-row {
      margin-bottom: 3px;
      line-height: 1.35;
    }

    /* Players panel */
    .players-header-row {
      position: relative;
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 6px;
      margin-bottom: 6px;
      flex-wrap: wrap;
    }
    .players-header-row h3 {
      margin-bottom: 0;
    }

    #activePlayerSelect {
      position: relative;
      min-width: 140px;
      border-radius: 999px;
      border: 1px solid rgba(151, 187, 255, 0.85);
      padding: 6px 12px;
      background: radial-gradient(circle at top, rgba(26, 90, 180, 0.75), rgba(7, 15, 35, 0.95));
      color: #eff3ff;
      font-size: 13px;
      outline: none;
    }

    .add-player-row {
      position: relative;
      display: flex;
      gap: 8px;
      margin-bottom: 8px;
      margin-top: 2px;
      flex-wrap: wrap;
    }
    .add-player-row input {
      flex: 1;
      min-width: 140px;
    }

    /* Scoreboard as stacked cards */
    .scoreboard-section {
      position: relative;
      margin-top: 4px;
    }
    .scoreboard-title {
      font-size: 11px;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.09em;
      color: rgba(206, 223, 255, 0.95);
      margin-bottom: 4px;
    }
    #scoreboardList {
      position: relative;
      max-height: 190px;
      overflow-y: auto;
      padding-right: 4px;
    }
    .player-card {
      background: radial-gradient(circle at top left, rgba(41, 84, 170, 0.85), rgba(5, 11, 26, 0.98));
      border-radius: 11px;
      border: 1px solid rgba(142, 185, 255, 0.7);
      padding: 6px 9px 7px;
      margin-bottom: 6px;
      font-size: 11px;
      display: flex;
      flex-direction: column;
      gap: 2px;
      box-shadow: 0 10px 16px rgba(0, 0, 0, 0.45);
    }
    .player-card.highlight {
      border-color: #4bd4ff;
      box-shadow: 0 0 14px rgba(84, 212, 255, 0.6);
    }
    .player-card-main {
      display: flex;
      justify-content: space-between;
      align-items: baseline;
      gap: 6px;
    }
    .player-name {
      font-weight: 600;
      font-size: 12px;
    }
    .player-score {
      font-weight: 600;
      color: #f4fbff;
    }
    .player-card-sub {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      color: rgba(217, 229, 255, 0.9);
    }
    .player-card-lastpick {
      color: rgba(201, 215, 247, 0.95);
      font-style: italic;
    }

    .tag {
      display: inline-flex;
      align-items: center;
      padding: 1px 7px;
      border-radius: 999px;
      background: rgba(12, 32, 74, 0.95);
      border: 1px solid rgba(143, 182, 255, 0.85);
      font-size: 10px;
      text-transform: uppercase;
      letter-spacing: 0.09em;
      color: rgba(220, 232, 255, 0.98);
    }

    .footer-mark {
      margin-top: 8px;
      font-size: 11px;
      text-align: right;
      color: rgba(205, 223, 255, 0.85);
    }

    /* Responsive */
    @media (max-width: 820px) {
      #app {
        padding-inline: 10px;
      }
      .game-grid {
        grid-template-columns: minmax(0, 1fr);
      }
      .active-player-summary {
        text-align: left;
      }
    }
    @media (max-width: 520px) {
      header h1 {
        font-size: 22px;
      }
      .panel {
        padding-inline: 12px;
      }
      .btn, .choice-btn {
        font-size: 13px;
        padding-inline: 12px;
      }
      #scoreboardList {
        max-height: 210px;
      }
    }
  </style>
</head>
<body>
<div id="app">
  <header>
    <h1>
      <span class="logo-ball">üèà</span>
      NextSnap
    </h1>
    <span class="pill">Designed by RDSM</span>
  </header>

  <!-- LOBBY -->
  <section id="lobbyView">
    <h2>Create a new game</h2>
    <div class="lobby-row">
      <input id="hostNameInput" type="text" placeholder="Name your game (e.g. Scott's Monday Night)" />
      <button id="hostGameBtn" class="btn">Host Game</button>
    </div>
    <p class="lobby-caption">
      You'll be the <strong>Host</strong>. You enter the real play after each snap.
      Everyone else tries to guess it before the ball is snapped.
    </p>
  </section>

  <!-- GAME VIEW -->
  <section id="gameView" class="hidden">
    <div class="game-header">
      <div>
        <button id="backToLobbyBtn" class="btn btn-secondary">‚Üê Back to Lobby</button>
        <div class="game-title" id="gameTitle"></div>
        <div class="game-meta" id="gameMeta"></div>
      </div>
      <div class="active-player-summary" id="activePlayerSummary"></div>
    </div>

    <div class="game-grid">
      <!-- Host panel -->
      <div class="panel" id="hostPanel">
        <h3>Host Actual Play</h3>
        <div class="panel-sub">
          Only the host uses this. Enter the <strong>real</strong> play after you see it
          (or after replay).
        </div>

        <div class="section-label">Play Type</div>
        <div class="btn-row">
          <button class="choice-btn inactive" data-host-type="run">Run</button>
          <button class="choice-btn inactive" data-host-type="pass">Pass</button>
          <button class="choice-btn inactive" data-host-type="playAction">Play-Action Pass</button>
        </div>

        <div class="section-label">Direction</div>
        <div class="btn-row">
          <button class="choice-btn inactive" data-host-dir="left">Left</button>
          <button class="choice-btn inactive" data-host-dir="center">Center</button>
          <button class="choice-btn inactive" data-host-dir="right">Right</button>
        </div>

        <div class="section-label">Depth (for Pass / Play-Action)</div>
        <div class="btn-row">
          <button class="choice-btn inactive" data-host-depth="short">Short</button>
          <button class="choice-btn inactive" data-host-depth="mid">Mid</button>
          <button class="choice-btn inactive" data-host-depth="deep">Deep</button>
        </div>

        <div class="controls-row">
          <button id="scoreSnapBtn" class="btn">Score This Snap</button>
          <button id="clearHostBtn" class="btn btn-danger">Clear Actual Play</button>
        </div>

        <div class="summary-text" id="hostCurrentSummary">
          Type: ‚Äì | Dir: ‚Äì | Depth: ‚Äì
        </div>

        <div class="last-snaps-box" id="hostLastSnapsBox">
          <div class="last-snaps-title">Last snaps (actual plays only)</div>
          <div id="hostLastSnapsList">
            <div class="last-snap-row">No snaps scored yet.</div>
          </div>
        </div>
      </div>

      <!-- Players panel -->
      <div class="panel" id="playersPanel">
        <div class="players-header-row">
          <h3>Players</h3>
          <div>
            <span class="tag">Max 10 players</span>
          </div>
        </div>

        <div class="section-label">Active player</div>
        <select id="activePlayerSelect"></select>

        <div class="add-player-row">
          <input id="newPlayerNameInput" type="text" placeholder="Add player name (e.g. Tony)" />
          <button id="addPlayerBtn" class="btn btn-secondary">Add Player</button>
        </div>

        <div class="section-label">Play Type</div>
        <div class="btn-row">
          <button class="choice-btn inactive" data-player-type="run">Run</button>
          <button class="choice-btn inactive" data-player-type="pass">Pass</button>
          <button class="choice-btn inactive" data-player-type="playAction">Play-Action Pass</button>
        </div>

        <div class="section-label">Direction</div>
        <div class="btn-row">
          <button class="choice-btn inactive" data-player-dir="left">Left</button>
          <button class="choice-btn inactive" data-player-dir="center">Center</button>
          <button class="choice-btn inactive" data-player-dir="right">Right</button>
        </div>

        <div class="section-label">Depth (for Pass / Play-Action)</div>
        <div class="btn-row">
          <button class="choice-btn inactive" data-player-depth="short">Short</button>
          <button class="choice-btn inactive" data-player-depth="mid">Mid</button>
          <button class="choice-btn inactive" data-player-depth="deep">Deep</button>
        </div>

        <div class="summary-text" id="playerCurrentSummary">
          Current pick: none (select a player)
        </div>

        <!-- Scoreboard as stacked cards -->
        <div class="scoreboard-section">
          <div class="scoreboard-title">Scoreboard</div>
          <div id="scoreboardList"></div>
        </div>

        <div class="last-snaps-box" id="playerLastSnapsBox">
          <div class="last-snaps-title" id="playerLastSnapsTitle">
            Last snaps for player
          </div>
          <div id="playerLastSnapsList">
            <div class="last-snap-row">No snaps scored yet for this player.</div>
          </div>
        </div>

        <div class="footer-mark">Designed by RDSM</div>
      </div>
    </div>
  </section>
</div>

<script>
  // ----- STATE -----
  const MAX_PLAYERS = 10;

  const state = {
    gameName: "",
    hostName: "",
    players: [],
    snaps: [],
    hostActual: { type: null, dir: null, depth: null },
    activePlayerId: null,
  };

  let nextPlayerId = 1;

  // ----- HELPERS -----
  const el = (id) => document.getElementById(id);

  function formatPlay(play) {
    if (!play || !play.type) return "‚Äì";
    const typeLabel =
      play.type === "run"
        ? "Run"
        : play.type === "pass"
        ? "Pass"
        : "Play-Action Pass";
    const dirLabel = play.dir
      ? play.dir === "left"
        ? "Left"
        : play.dir === "right"
        ? "Right"
        : "Center"
      : "‚Äì";
    const depthLabel = play.depth
      ? play.depth === "short"
        ? "Short"
        : play.depth === "mid"
        ? "Mid"
        : "Deep"
      : "‚Äì";
    return `${typeLabel} | Dir: ${dirLabel} | Depth: ${depthLabel}`;
  }

  function getDepthEnabled(type) {
    return type === "pass" || type === "playAction";
  }

  function getActivePlayer() {
    return state.players.find((p) => p.id === state.activePlayerId) || null;
  }

  // ----- LOBBY -----
  function showLobby() {
    el("lobbyView").classList.remove("hidden");
    el("gameView").classList.add("hidden");
  }

  function showGame() {
    el("lobbyView").classList.add("hidden");
    el("gameView").classList.remove("hidden");
  }

  function startGameFromLobby() {
    const rawName = el("hostNameInput").value.trim();
    state.hostName = rawName || "Host";
    state.gameName = rawName || "Untitled game";

    // Reset state
    state.players = [];
    state.snaps = [];
    state.hostActual = { type: null, dir: null, depth: null };
    nextPlayerId = 1;

    // Add host as first player
    const hostPlayer = {
      id: nextPlayerId++,
      name: state.hostName + " (Host)",
      score: 0,
      streak: 0,
      lastSnapPoints: 0,
      lastPick: null,
      guess: { type: null, dir: null, depth: null },
    };
    state.players.push(hostPlayer);
    state.activePlayerId = hostPlayer.id;

    // Render
    el("gameTitle").textContent = state.gameName;
    renderGameMeta();
    renderAll();
    showGame();
  }

  function renderGameMeta() {
    const playersCount = state.players.length;
    const meta = `${state.gameName} ‚Ä¢ Host: ${state.hostName} ‚Ä¢ Players: ${playersCount}/10`;
    el("gameMeta").textContent = meta;
  }

  // ----- HOST CONTROLS -----
  function setHostType(type) {
    state.hostActual.type = type;
    // If it's a run, depth is irrelevant
    if (!getDepthEnabled(type)) {
      state.hostActual.depth = null;
    }
    renderAll();
  }

  function setHostDir(dir) {
    state.hostActual.dir = dir;
    renderAll();
  }

  function setHostDepth(depth) {
    if (!getDepthEnabled(state.hostActual.type)) {
      // ignore depth when type is Run
      return;
    }
    state.hostActual.depth = depth;
    renderAll();
  }

  function clearHostActual() {
    state.hostActual = { type: null, dir: null, depth: null };
    renderAll();
  }

  // ----- PLAYER CONTROLS -----
  function setPlayerType(type) {
    const p = getActivePlayer();
    if (!p) return;
    p.guess.type = type;
    if (!getDepthEnabled(type)) {
      p.guess.depth = null;
    }
    renderAll();
  }

  function setPlayerDir(dir) {
    const p = getActivePlayer();
    if (!p) return;
    p.guess.dir = dir;
    renderAll();
  }

  function setPlayerDepth(depth) {
    const p = getActivePlayer();
    if (!p) return;
    if (!getDepthEnabled(p.guess.type)) {
      // ignore depth when type is run
      return;
    }
    p.guess.depth = depth;
    renderAll();
  }

  function addPlayer(nameRaw) {
    const name = nameRaw.trim();
    if (!name) return;
    if (state.players.length >= MAX_PLAYERS) {
      alert("Max players (10) reached.");
      return;
    }
    const player = {
      id: nextPlayerId++,
      name,
      score: 0,
      streak: 0,
      lastSnapPoints: 0,
      lastPick: null,
      guess: { type: null, dir: null, depth: null },
    };
    state.players.push(player);
    state.activePlayerId = player.id;
    el("newPlayerNameInput").value = "";
    renderGameMeta();
    renderAll();
  }

  // ----- SCORING -----
  function scoreThisSnap() {
    if (!state.hostActual.type) {
      alert("Set the actual play type first.");
      return;
    }
    if (!state.players.length) {
      alert("No players in this game.");
      return;
    }

    const snapNumber = state.snaps.length + 1;
    const actual = { ...state.hostActual };

    const perPlayer = [];

    state.players.forEach((p) => {
      const guess = { ...p.guess };
      let points = 0;

      if (guess.type) {
        const typeCorrect = guess.type === actual.type;

        const dirCorrect =
          typeCorrect &&
          !!guess.dir &&
          !!actual.dir &&
          guess.dir === actual.dir;

        const depthCorrect =
          typeCorrect &&
          getDepthEnabled(actual.type) &&
          !!guess.depth &&
          !!actual.depth &&
          guess.depth === actual.depth;

        if (typeCorrect) points += 10;
        if (typeCorrect && dirCorrect) points += 20;
        if (typeCorrect && depthCorrect) points += 40;

        // update player totals
        p.score += points;
        p.lastSnapPoints = points;
        if (points > 0) {
          p.streak += 1;
        } else {
          p.streak = 0;
        }
        p.lastPick = guess.type ? { ...guess } : p.lastPick;
      } else {
        // no pick made
        p.lastSnapPoints = 0;
      }

      perPlayer.push({
        playerId: p.id,
        name: p.name,
        guess,
        points,
      });

      // reset guess for next snap
      p.guess = { type: null, dir: null, depth: null };
    });

    state.snaps.push({
      number: snapNumber,
      actual,
      perPlayer,
    });

    renderAll();
  }

  // ----- RENDERING -----
  function renderHostPanel() {
    // highlight host buttons
    document
      .querySelectorAll("[data-host-type]")
      .forEach((btn) => {
        const val = btn.getAttribute("data-host-type");
        const active = state.hostActual.type === val;
        btn.classList.toggle("inactive", !active);
      });

    document
      .querySelectorAll("[data-host-dir]")
      .forEach((btn) => {
        const val = btn.getAttribute("data-host-dir");
        const active = state.hostActual.dir === val;
        btn.classList.toggle("inactive", !active);
      });

    document
      .querySelectorAll("[data-host-depth]")
      .forEach((btn) => {
        const val = btn.getAttribute("data-host-depth");
        const active = state.hostActual.depth === val;
        const disabled = !getDepthEnabled(state.hostActual.type);
        btn.classList.toggle("inactive", !active);
        btn.classList.toggle("disabled", disabled);
      });

    el("hostCurrentSummary").textContent =
      "Current actual play: " + formatPlay(state.hostActual);

    // host last snaps (actual only)
    const list = el("hostLastSnapsList");
    list.innerHTML = "";
    if (!state.snaps.length) {
      const row = document.createElement("div");
      row.className = "last-snap-row";
      row.textContent = "No snaps scored yet.";
      list.appendChild(row);
    } else {
      state.snaps
        .slice()
        .reverse()
        .forEach((snap) => {
          const row = document.createElement("div");
          row.className = "last-snap-row";
          row.textContent = `Snap ${snap.number}: ${formatPlay(
            snap.actual
          )}`;
          list.appendChild(row);
        });
    }
  }

  function renderActivePlayerSummary() {
    const p = getActivePlayer();
    if (!p) {
      el("activePlayerSummary").textContent = "";
      return;
    }
    const snapsCount = state.snaps.length;
    el("activePlayerSummary").textContent = `Active player: ${
      p.name
    } ‚Ä¢ Score: ${p.score} ‚Ä¢ Last snap: ${
      p.lastSnapPoints >= 0 ? "+" : ""
    }${p.lastSnapPoints} ‚Ä¢ Streak: ${p.streak} ‚Ä¢ Snaps scored in this game: ${snapsCount}`;
  }

  function renderPlayerControls() {
    // active player select
    const select = el("activePlayerSelect");
    select.innerHTML = "";
    state.players.forEach((p) => {
      const opt = document.createElement("option");
      opt.value = p.id;
      opt.textContent = p.name;
      if (p.id === state.activePlayerId) opt.selected = true;
      select.appendChild(opt);
    });

    const p = getActivePlayer();

    // highlight type/dir/depth buttons
    document
      .querySelectorAll("[data-player-type]")
      .forEach((btn) => {
        const val = btn.getAttribute("data-player-type");
        const active = p && p.guess.type === val;
        btn.classList.toggle("inactive", !active);
      });

    document
      .querySelectorAll("[data-player-dir]")
      .forEach((btn) => {
        const val = btn.getAttribute("data-player-dir");
        const active = p && p.guess.dir === val;
        btn.classList.toggle("inactive", !active);
      });

    document
      .querySelectorAll("[data-player-depth]")
      .forEach((btn) => {
        const val = btn.getAttribute("data-player-depth");
        const active = p && p.guess.depth === val;
        const disabled = !(p && getDepthEnabled(p.guess.type));
        btn.classList.toggle("inactive", !active);
        btn.classList.toggle("disabled", disabled);
      });

    // summary
    if (!p) {
      el("playerCurrentSummary").textContent =
        "Current pick: none (select a player)";
    } else {
      el("playerCurrentSummary").textContent =
        "Current pick for " + p.name + ": " + formatPlay(p.guess);
    }
  }

  function renderScoreboard() {
    const list = el("scoreboardList");
    list.innerHTML = "";
    if (!state.players.length) {
      const empty = document.createElement("div");
      empty.className = "last-snap-row";
      empty.textContent = "No players yet.";
      list.appendChild(empty);
      return;
    }

    // sort by score desc
    const sorted = [...state.players].sort((a, b) => b.score - a.score);

    sorted.forEach((p, index) => {
      const card = document.createElement("div");
      card.className = "player-card";
      if (p.id === state.activePlayerId) {
        card.classList.add("highlight");
      }

      const main = document.createElement("div");
      main.className = "player-card-main";

      const name = document.createElement("span");
      name.className = "player-name";
      name.textContent = `${index + 1}. ${p.name}`;

      const score = document.createElement("span");
      score.className = "player-score";
      score.textContent = `Score: ${p.score}`;

      main.appendChild(name);
      main.appendChild(score);
      card.appendChild(main);

      const sub = document.createElement("div");
      sub.className = "player-card-sub";
      const last = document.createElement("span");
      last.textContent = `Last snap: ${
        p.lastSnapPoints >= 0 ? "+" : ""
      }${p.lastSnapPoints}`;
      const streak = document.createElement("span");
      streak.textContent = `Streak: ${p.streak}`;
      sub.appendChild(last);
      sub.appendChild(streak);
      card.appendChild(sub);

      const lp = document.createElement("div");
      lp.className = "player-card-lastpick";
      lp.textContent =
        "Last pick: " + (p.lastPick ? formatPlay(p.lastPick) : "‚Äì");
      card.appendChild(lp);

      list.appendChild(card);
    });
  }

  function renderPlayerLastSnaps() {
    const p = getActivePlayer();
    const list = el("playerLastSnapsList");
    const title = el("playerLastSnapsTitle");

    if (!p) {
      title.textContent = "Last snaps for player";
      list.innerHTML =
        '<div class="last-snap-row">No player selected.</div>';
      return;
    }

    title.textContent = `Last snaps for ${p.name}`;

    const snapsForPlayer = state.snaps.filter((snap) =>
      snap.perPlayer.some((pp) => pp.playerId === p.id)
    );

    list.innerHTML = "";
    if (!snapsForPlayer.length) {
      const row = document.createElement("div");
      row.className = "last-snap-row";
      row.textContent = "No snaps scored yet for this player.";
      list.appendChild(row);
      return;
    }

    snapsForPlayer
      .slice()
      .reverse()
      .forEach((snap) => {
        const per = snap.perPlayer.find((pp) => pp.playerId === p.id);
        const row = document.createElement("div");
        row.className = "last-snap-row";
        const guessText = per.guess.type
          ? formatPlay(per.guess)
          : "no pick";
        row.textContent = `Snap ${snap.number}: Actual: ${formatPlay(
          snap.actual
        )} | Your pick: ${guessText} | ${
          per.points >= 0 ? "+" : ""
        }${per.points}`;
        list.appendChild(row);
      });
  }

  function renderAll() {
    renderHostPanel();
    renderActivePlayerSummary();
    renderPlayerControls();
    renderScoreboard();
    renderPlayerLastSnaps();
  }

  // ----- EVENT WIRING -----
  function setupEventHandlers() {
    el("hostGameBtn").onclick = startGameFromLobby;
    el("backToLobbyBtn").onclick = showLobby;

    // Host buttons
    document
      .querySelectorAll("[data-host-type]")
      .forEach((btn) => {
        btn.onclick = () =>
          setHostType(btn.getAttribute("data-host-type"));
      });

    document
      .querySelectorAll("[data-host-dir]")
      .forEach((btn) => {
        btn.onclick = () =>
          setHostDir(btn.getAttribute("data-host-dir"));
      });

    document
      .querySelectorAll("[data-host-depth]")
      .forEach((btn) => {
        btn.onclick = () =>
          setHostDepth(btn.getAttribute("data-host-depth"));
      });

    el("scoreSnapBtn").onclick = scoreThisSnap;
    el("clearHostBtn").onclick = clearHostActual;

    // Player buttons
    document
      .querySelectorAll("[data-player-type]")
      .forEach((btn) => {
        btn.onclick = () =>
          setPlayerType(btn.getAttribute("data-player-type"));
      });

    document
      .querySelectorAll("[data-player-dir]")
      .forEach((btn) => {
        btn.onclick = () =>
          setPlayerDir(btn.getAttribute("data-player-dir"));
      });

    document
      .querySelectorAll("[data-player-depth]")
      .forEach((btn) => {
        btn.onclick = () =>
          setPlayerDepth(btn.getAttribute("data-player-depth"));
      });

    el("activePlayerSelect").onchange = (e) => {
      state.activePlayerId = Number(e.target.value);
      renderAll();
    };

    el("addPlayerBtn").onclick = () => {
      addPlayer(el("newPlayerNameInput").value);
    };

    el("newPlayerNameInput").addEventListener("keyup", (e) => {
      if (e.key === "Enter") {
        addPlayer(el("newPlayerNameInput").value);
      }
    });
  }

  // Init
  setupEventHandlers();
  showLobby();
</script>
</body>
</html>
